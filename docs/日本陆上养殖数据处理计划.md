# 日本陆上养殖数据处理计划（南美白对虾）

**版本：** v1.0  
**编制日期：** 2025.11.18  
**负责人/单位：** AI产业部  
**适用范围：** 适用于日本地区陆上工厂化养殖的南美白对虾数据采集、处理、质量管理与验收全流程。

## 1. 背景与目标

### 背景
为提升陆上养殖数据管理质量与应用效率，建立统一的数据标准、采集流程、处理规范与验收体系。

### 目标
- 明确数据分类与来源，统一元数据与命名规范。
- 标准化采集流程与数据处理管道（ETL/ELT）。
- 建立数据质量指标与验收机制，保障数据可用性与一致性。
- 支撑养殖运营分析、智能监测与策略优化。

## 2. 术语与定义

- **结构化数据**：具有固定模式的数据（如数据库表）。
- **非结构化数据**：无固定模式的原始文本、图像、视频等。
- **半结构化数据**：具有一定结构标识的文本（如CSV、JSON、XML、YAML）。
- **自动标注数据**：由算法或设备自动生成标签的记录。
- **人工标注数据**：由人工审核与纠偏后生成的标签。
- **元数据**：描述数据的数据，包括来源、时间、位置、设备、采集方式、质量状态等。

## 3. 数据分类体系

### 按类型
- **文本数据**：操作日志、养殖手册、历史记录（报告、记录表、备注）。
- **图像/视频数据**：目标监测图像、视频帧、标注文件。

### 按来源
- **自动标注**：传感器自动采集、图像算法生成标签、喂食机自动记录。
- **人工标注**：人工审核纠偏后的标签与记录。

### 按数据格式
- **结构化**：数据库表（MySQL）。
- **非结构化**：原始图像/视频、自由文本。
- **半结构化**：CSV、JSON、XML、YAML 等。

### 按频率
- **高频变化**
- **低频变化**

## 4. 数据源与采集方式

> 注：红底表示高频变化，蓝底表示低频变化；绿色为自动标注、蓝色为人工标注，黄色为待补充数据、紫色为争议数据。

### 传感器数据
（以水产环境为主，同时包含光照与室内环境参数）

- **典型指标**：水温、浊度、pH、溶解氧（DO）、水位、盐度、氨氮、亚硝酸盐、光照强度、室内温湿度。
- **采集方式**：设备侧定时采集→客户端定时上传→服务器接收、清洗、入库。
- **采样周期**：建议1–10分钟，按场景配置。

### 图像目标监测数据

- **具体目标与输出字段**：目标估计（检测数量、检测长度、检测高度、预估体重、有无饲料、有无虾皮、检测时间）。
- **采集方式**：摄像头→客户端用户触发上传→服务器算法推理（检测/估计）→生成标注与汇总→存储与索引。

### 喂食机数据

- **字段示例**：喂食时间、喂食量、喂食次数、剩余饵料估计、设备状态、运行时长。
- **采集方式**：设备侧记录→客户端上传→服务器处理与入库。

### 操作日志数据

- **字段示例**：操作时间、操作人、操作类型（投料、水质调控、巡检、清洗等）、备注。
- **采集方式**：人工录入→上传→规范化处理→知识库/数据库。

### 养殖手册文档

- **内容**：操作流程、注意事项、异常处置SOP。
- **采集方式**：人工上传→解析（必要时OCR/NLP）→结构化抽取→知识库。

### 往期养殖记录

- **内容**：批次记录、苗种来源、放养密度、成活率、规格(面积、水循环量、养殖品类)、产出、执行授权、异常。
- **采集方式**：人工上传→清洗→结构化→知识库/数据库。

### 当期养殖记录

- **内容**：批次记录、苗种来源、放养密度、成活率、规格(面积、水循环量、养殖品类)、产出、执行授权、异常。

## 5. 元数据标准与命名规范

### 通用元数据字段

- `data_id`、`source_type`（sensor/image/feed/log/manual/history）
- `device_id` / `camera_id` / `feeder_id`、`operator_id`（如适用）
- `timestamp_utc`、`timestamp_local`（日本时区）
- `location`（场地/车间/池号）、`batch_id`（养殖批次）
- `unit`（计量单位）、`sampling_rate`（采样频率）
- `quality_flag`（合格/缺失/异常）、`checksum`（完整性校验）

### 图像与标注元数据补充

- `resolution`、`format`（jpg/png/mp4）、`codec`（视频）
- `annotation_type`（count/size/weight/boolean_flags）、`model_name`、`model_version`

### 文件命名规范（示例）

- **传感器**：`sensor_{deviceId}{poolId}{batchId}_{YYYYMMDDHHmmss}.csv`
- **图像**：`img_{cameraId}{poolId}{batchId}_{YYYYMMDDHHmmss}.jpg`
- **标注汇总**：`ann_{cameraId}{poolId}{batchId}_{YYYYMMDDHHmmss}.json`
- **日志**：`log_{operatorId}{poolId}{YYYYMMDD}.csv`

### 目录结构建议（示例）

```
/data/raw/{type}/{YYYY}/{MM}/{DD}/
/data/processed/{type}/{batchId}/
/data/annotations/{batchId}/
/data/docs/manuals/、/data/docs/history/
```

## 6. 数据存储与表设计（MySQL，需规范化重设计）

### 总体原则

- 分库分表按批次与池号进行水平拆分；主键与外键清晰；时间与批次为核心索引。
- 命名规范：小写+下划线；示例：`aquaculture`、`sensor_readings`、`image_frames`、`image_detections` 等。

### 建议的库与核心表（初稿）

- **库**：`aquaculture`（或按项目划分）。

#### batches（批次信息）

- **字段**：`batch_id`（PK）、`species`（默认"Litopenaeus vannamei"）、`pool_id`、`location`、`seed_origin`、`stocking_density`、`start_date`、`end_date`、`notes`。
- **索引**：`pool_id`、`start_date`、`end_date`。

#### devices（设备清单）

- **字段**：`device_id`（PK）、`type`（sensor/camera/feeder）、`model`、`install_location`、`pool_id`、`status`、`vendor`、`calibration_info`、`created_at`。
- **索引**：`type`、`pool_id`。

#### sensor_readings（传感器读数，窄表设计）

- **字段**：`id`（PK）、`device_id`（FK）、`batch_id`（FK）、`pool_id`、`ts_utc`、`ts_local`、`metric`（如 do、ph、temp 等）、`value`、`unit`、`quality_flag`、`checksum`。
- **索引**：`device_id+ts_utc`、`batch_id+metric+ts_utc`。

#### feeders_logs（喂食机记录）

- **字段**：`id`（PK）、`feeder_id`（FK）、`batch_id`（FK）、`pool_id`、`ts_utc`、`ts_local`、`feed_amount_g`、`run_time_s`、`status`、`leftover_estimate_g`、`notes`、`checksum`。
- **索引**：`feeder_id+ts_utc`、`batch_id+ts_utc`。

#### image_frames（图像帧与元数据）

- **字段**：`id`（PK）、`camera_id`（FK）、`batch_id`（FK）、`pool_id`、`ts_utc`、`ts_local`、`storage_uri`、`width_px`、`height_px`、`format`、`codec`、`quality_flag`、`checksum`。
- **索引**：`camera_id+ts_utc`、`batch_id+ts_utc`。

#### image_detections（图像检测汇总结果）

- **字段**：`id`（PK）、`frame_id`（FK）、`ts_utc`、`count`、`avg_length_mm`、`avg_height_mm`、`est_weight_g_avg`、`feed_present`（bool）、`shrimp_shell_present`（bool）、`model_name`、`model_version`、`confidence_avg`、`notes`。
- **索引**：`frame_id`、`ts_utc`、`model_name+model_version`。

#### operations_logs（操作日志）

- **字段**：`id`（PK）、`operator_id`、`batch_id`（FK）、`pool_id`、`ts_utc`、`ts_local`、`action_type`、`remarks`、`attachment_uri`。
- **索引**：`operator_id+ts_utc`、`batch_id+ts_utc`。

#### manuals_docs（养殖手册文档）

- **字段**：`id`（PK）、`doc_uri`、`version`、`source`、`created_at`、`updated_at`、`notes`。
- **索引**：`version`、`created_at`。

#### history_records（往期养殖记录-结构化化）

- **字段**：`id`（PK）、`batch_id`（FK）、`metric_name`、`value`、`unit`、`ts_utc`、`ts_local`、`notes`。
- **索引**：`batch_id+metric_name+ts_utc`。

**说明**：以上为初稿结构，后续将提交DDL与约束（非空、唯一、外键、检查约束）以及分区与归档策略。

## 6.1 数据库表结构与DDL（MySQL 8.0+）

### 设计原则与说明

- **数据库**：`aquaculture`；字符集 `utf8mb4`；引擎 `InnoDB`；时区字段统一使用 `ts_utc`（必填）与 `ts_local`（选填，日本时区），精度使用 `DATETIME(3)`。
- **传感器采用"窄表"设计**（metric + value），支持水温、盐度、电导率、pH、溶解氧、氨氮、亚硝酸盐、浊度、碱度、水位/流速、光照强度、室内温湿度等扩展。
- **布尔值统一使用** `TINYINT(1)`（0/1），避免不同驱动对 BOOLEAN 的兼容差异。
- **外键统一引用** `batches`（批次）与 `devices`（设备）；查询主维度为时间（`ts_utc`）与批次（`batch_id`），建立相应联合索引。
- **建议读写并发较高的时间序列表**（`sensor_readings`、`image_frames`、`image_detections`、`feeders_logs`）在评估后采用按时间范围的分区/分表策略（例如 `RANGE COLUMNS(ts_utc)` 按月分区）。

### 完整DDL（可直接导入）

```sql
-- 数据库与全局设置
CREATE DATABASE IF NOT EXISTS aquaculture
  DEFAULT CHARACTER SET utf8mb4
  DEFAULT COLLATE utf8mb4_0900_ai_ci;
USE aquaculture;

-- 1) 批次信息
CREATE TABLE IF NOT EXISTS batches (
  batch_id           BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '批次ID（主键）',
  species            VARCHAR(64) NOT NULL DEFAULT 'Litopenaeus vannamei' COMMENT '物种（默认南美白对虾学名）',
  pool_id            VARCHAR(64) NOT NULL COMMENT '池号/分区标识',
  location           VARCHAR(128) NULL COMMENT '场地/车间位置',
  seed_origin        VARCHAR(128) NULL COMMENT '苗种来源',
  stocking_density   DECIMAL(10,2) NULL COMMENT '放养密度（尾/㎡或尾/m³）',
  start_date         DATE NOT NULL COMMENT '开始日期',
  end_date           DATE NULL COMMENT '结束日期（可空）',
  notes              TEXT NULL COMMENT '备注',
  created_at         TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  updated_at         TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间'
) COMMENT='养殖批次信息';

CREATE INDEX idx_batches_pool_dates ON batches (pool_id, start_date, end_date);

-- 2) 设备清单
CREATE TABLE IF NOT EXISTS devices (
  device_id          BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '设备ID（主键）',
  type               ENUM('sensor','camera','feeder') NOT NULL COMMENT '设备类型',
  model              VARCHAR(128) NULL COMMENT '设备型号',
  install_location   VARCHAR(128) NULL COMMENT '安装位置',
  pool_id            VARCHAR(64) NULL COMMENT '池号/分区（如适用）',
  status             ENUM('active','inactive','maintenance','fault') NOT NULL DEFAULT 'active' COMMENT '设备状态',
  vendor             VARCHAR(128) NULL COMMENT '供应商',
  calibration_info   TEXT NULL COMMENT '校准信息',
  created_at         TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  updated_at         TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间'
) COMMENT='设备（传感器/摄像头/喂食机）清单';

CREATE INDEX idx_devices_type_pool ON devices (type, pool_id);

-- 3) 传感器读数（窄表）
CREATE TABLE IF NOT EXISTS sensor_readings (
  id                 BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
  device_id          BIGINT UNSIGNED NOT NULL COMMENT '设备ID（FK）',
  batch_id           BIGINT UNSIGNED NULL COMMENT '批次ID（FK）',
  pool_id            VARCHAR(64) NULL COMMENT '池号/分区（冗余便于查询）',
  ts_utc             DATETIME(3) NOT NULL COMMENT 'UTC时间戳（毫秒）',
  ts_local           DATETIME(3) NULL COMMENT '本地时间戳（日本时区）',
  metric             VARCHAR(32) NOT NULL COMMENT '指标，如 do/ph/temp/salinity/conductivity 等',
  value              DOUBLE NOT NULL COMMENT '数值',
  unit               VARCHAR(16) NULL COMMENT '计量单位',
  quality_flag       ENUM('ok','missing','anomaly') NOT NULL DEFAULT 'ok' COMMENT '质量标记',
  checksum           VARCHAR(64) NULL COMMENT '完整性校验',
  created_at         TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  updated_at         TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  CONSTRAINT fk_sr_device FOREIGN KEY (device_id) REFERENCES devices(device_id),
  CONSTRAINT fk_sr_batch  FOREIGN KEY (batch_id)  REFERENCES batches(batch_id)
) COMMENT='传感器读数（窄表设计，metric+value）';

CREATE INDEX idx_sr_device_ts ON sensor_readings (device_id, ts_utc);
CREATE INDEX idx_sr_batch_metric_ts ON sensor_readings (batch_id, metric, ts_utc);

-- 4) 喂食机记录
CREATE TABLE IF NOT EXISTS feeders_logs (
  id                 BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
  feeder_id          BIGINT UNSIGNED NOT NULL COMMENT '喂食机设备ID（FK）',
  batch_id           BIGINT UNSIGNED NULL COMMENT '批次ID（FK）',
  pool_id            VARCHAR(64) NULL COMMENT '池号/分区（冗余）',
  ts_utc             DATETIME(3) NOT NULL COMMENT 'UTC时间戳',
  ts_local           DATETIME(3) NULL COMMENT '本地时间戳',
  feed_amount_g      DECIMAL(12,3) NULL COMMENT '投喂量（克）',
  run_time_s         INT NULL COMMENT '运行时长（秒）',
  status             ENUM('ok','warning','error') NOT NULL DEFAULT 'ok' COMMENT '状态',
  leftover_estimate_g DECIMAL(12,3) NULL COMMENT '剩余饵料估计（克）',
  notes              TEXT NULL COMMENT '备注',
  checksum           VARCHAR(64) NULL COMMENT '完整性校验',
  created_at         TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  updated_at         TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  CONSTRAINT fk_fl_feeder FOREIGN KEY (feeder_id) REFERENCES devices(device_id),
  CONSTRAINT fk_fl_batch  FOREIGN KEY (batch_id)  REFERENCES batches(batch_id)
) COMMENT='喂食机运行记录';

CREATE INDEX idx_fl_feeder_ts ON feeders_logs (feeder_id, ts_utc);
CREATE INDEX idx_fl_batch_ts   ON feeders_logs (batch_id, ts_utc);

-- 5) 图像帧与元数据
CREATE TABLE IF NOT EXISTS image_frames (
  id                 BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
  camera_id          BIGINT UNSIGNED NOT NULL COMMENT '摄像头设备ID（FK）',
  batch_id           BIGINT UNSIGNED NULL COMMENT '批次ID（FK）',
  pool_id            VARCHAR(64) NULL COMMENT '池号/分区（冗余）',
  ts_utc             DATETIME(3) NOT NULL COMMENT 'UTC时间戳',
  ts_local           DATETIME(3) NULL COMMENT '本地时间戳',
  storage_uri        VARCHAR(512) NOT NULL COMMENT '对象存储路径/URI',
  width_px           INT NULL COMMENT '宽度像素',
  height_px          INT NULL COMMENT '高度像素',
  format             VARCHAR(16) NULL COMMENT '格式（jpg/png/mp4）',
  codec              VARCHAR(32) NULL COMMENT '编解码（视频）',
  quality_flag       ENUM('ok','missing','anomaly') NOT NULL DEFAULT 'ok' COMMENT '质量标记',
  checksum           VARCHAR(64) NULL COMMENT '完整性校验',
  created_at         TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  updated_at         TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  CONSTRAINT fk_if_camera FOREIGN KEY (camera_id) REFERENCES devices(device_id),
  CONSTRAINT fk_if_batch  FOREIGN KEY (batch_id)  REFERENCES batches(batch_id)
) COMMENT='图像帧与元数据';

CREATE INDEX idx_if_camera_ts ON image_frames (camera_id, ts_utc);
CREATE INDEX idx_if_batch_ts  ON image_frames (batch_id, ts_utc);

-- 6) 图像检测汇总结果
CREATE TABLE IF NOT EXISTS image_detections (
  id                 BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
  frame_id           BIGINT UNSIGNED NOT NULL COMMENT '图像帧ID（FK）',
  ts_utc             DATETIME(3) NOT NULL COMMENT 'UTC时间戳（推理）',
  count              INT NOT NULL COMMENT '检测数量',
  avg_length_mm      DECIMAL(12,3) NULL COMMENT '平均长度（毫米）',
  avg_height_mm      DECIMAL(12,3) NULL COMMENT '平均高度（毫米）',
  est_weight_g_avg   DECIMAL(12,3) NULL COMMENT '平均估算体重（克）',
  feed_present       TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否存在饲料（布尔）',
  shrimp_shell_present TINYINT(1) NOT NULL DEFAULT 0 COMMENT '是否存在虾皮（布尔）',
  model_name         VARCHAR(128) NULL COMMENT '模型名称',
  model_version      VARCHAR(64) NULL COMMENT '模型版本',
  confidence_avg     DECIMAL(5,4) NULL COMMENT '平均置信度',
  notes              TEXT NULL COMMENT '备注',
  created_at         TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  updated_at         TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  CONSTRAINT fk_id_frame FOREIGN KEY (frame_id) REFERENCES image_frames(id)
) COMMENT='图像检测汇总（数量/尺寸/体重/饲料/虾皮）';

CREATE INDEX idx_id_frame    ON image_detections (frame_id);
CREATE INDEX idx_id_ts       ON image_detections (ts_utc);
CREATE INDEX idx_id_modelver ON image_detections (model_name, model_version);

-- 7) 操作日志
CREATE TABLE IF NOT EXISTS operations_logs (
  id                 BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
  operator_id        VARCHAR(64) NOT NULL COMMENT '操作人',
  batch_id           BIGINT UNSIGNED NULL COMMENT '批次ID（FK）',
  pool_id            VARCHAR(64) NULL COMMENT '池号/分区',
  ts_utc             DATETIME(3) NOT NULL COMMENT 'UTC时间戳',
  ts_local           DATETIME(3) NULL COMMENT '本地时间戳',
  action_type        VARCHAR(64) NOT NULL COMMENT '操作类型（投料/水质调控/巡检/清洗等）',
  remarks            TEXT NULL COMMENT '备注',
  attachment_uri     VARCHAR(512) NULL COMMENT '附件URI',
  created_at         TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  updated_at         TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  CONSTRAINT fk_ol_batch FOREIGN KEY (batch_id) REFERENCES batches(batch_id)
) COMMENT='人工操作日志';

CREATE INDEX idx_ol_operator_ts ON operations_logs (operator_id, ts_utc);
CREATE INDEX idx_ol_batch_ts    ON operations_logs (batch_id, ts_utc);

-- 8) 养殖手册文档
CREATE TABLE IF NOT EXISTS manuals_docs (
  id                 BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
  doc_uri            VARCHAR(512) NOT NULL COMMENT '文档URI',
  version            VARCHAR(64) NULL COMMENT '版本',
  source             VARCHAR(64) NULL COMMENT '来源',
  created_at         TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  updated_at         TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  notes              TEXT NULL COMMENT '备注'
) COMMENT='养殖手册/文档索引';

CREATE INDEX idx_md_version ON manuals_docs (version);
CREATE INDEX idx_md_created ON manuals_docs (created_at);

-- 9) 往期养殖记录（结构化）
CREATE TABLE IF NOT EXISTS history_records (
  id                 BIGINT UNSIGNED PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
  batch_id           BIGINT UNSIGNED NULL COMMENT '批次ID（FK）',
  metric_name        VARCHAR(64) NOT NULL COMMENT '指标名称',
  value              VARCHAR(128) NOT NULL COMMENT '值（文本存储）',
  unit               VARCHAR(16) NULL COMMENT '单位',
  ts_utc             DATETIME(3) NULL COMMENT 'UTC时间戳',
  ts_local           DATETIME(3) NULL COMMENT '本地时间戳',
  notes              TEXT NULL COMMENT '备注',
  created_at         TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  updated_at         TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  CONSTRAINT fk_hr_batch FOREIGN KEY (batch_id) REFERENCES batches(batch_id)
) COMMENT='往期养殖记录（结构化）';

CREATE INDEX idx_hr_batch_metric_ts ON history_records (batch_id, metric_name, ts_utc);

-- 示例校验语句（导入后可执行）
-- SHOW TABLES; SELECT COUNT(*) FROM information_schema.tables WHERE table_schema='aquaculture';
```

## 7. 数据处理标准与流程（ETL/ELT）

### 原始数据接收
- 完整性校验（checksum）、基本格式校验（字段、类型、单位）。

### 清洗与标准化
- 时间标准化（统一时区与格式）、单位换算（如盐度、溶氧单位统一）。
- 缺失值处理：按规则插补（线性/卡尔曼/领域规则）、删除或标记。
- 异常值处理：范围校验、传感器漂移检测、设备故障识别与剔除/修订。

### 转换与入库
- 结构化入库（主键与索引设计）；非结构化入对象存储并建立索引表（`image_frames`）。
- 版本化：数据版本号与处理流水号（`pipeline_run_id`）。

### 图像数据处理
- 算法推理（数量/长度/高度/体重估计、饲料/虾皮存在标记），生成检测汇总与质量分。
- 标注审核（自动→人工抽检→纠偏）。

### 处理管道生命周期
- 任务编排（定时/事件触发）、失败重试、错误日志记录、指标监控（时延、成功率）。

## 8. 数据质量管理

### 核心质量指标
完整性（缺失比例）、一致性（字段与单位统一）、准确性（与标准或人工校验一致度）、及时性（延迟）、可追溯性（元数据完整度）。

### 规则与阈值（示例）
- **溶氧 DO 范围**：0–20 mg/L（越界标记异常）。
- **pH 范围**：6.5–9.0（越界触发告警与人工复核）。
- **时间戳延迟**：设备到入库≤5分钟（可配置）。
- **图像检测**：`count≥0`、`confidence_avg≥0.6`；长度/高度/体重估计需在模型训练范围内。

### 抽检机制
- 自动验收前抽检10%记录；图像标注人工抽检5%并计算一致度。

### 问题处理
缺失/异常标记→原因分析（设备、网络、人工）→纠正措施→复验。

## 9. 验收流程与标准

### 验收方式
- **自动验收**（待建设）：规则引擎校验通过、处理标准达成、元数据完整。
- **人工验收**：抽检合格、关键批次全检。

### 验收标准
格式、单位、范围、时序一致；元数据齐全；满足后续分析/模型训练需求。

### 验收流程（文本化）
数据接收→基础校验→清洗标准化→质量规则校验→自动验收→人工抽检→入库/归档→验收报告生成。

### 验收产出
- 批次验收报告（质量指标、问题清单、处置与结论）。
- 验收台账（可追溯与审计）。

## 10. 监督与审计

- 当前不纳入日本当地合规审计要求（按需求澄清）。
- 保留操作日志与变更记录能力，以便未来扩展。

## 11. 角色与职责

- **数据所有者（Owner）**：确定数据需求与质量目标。
- **数据管理员（Steward）**：定义标准、维护目录与规则。
- **审核员（Reviewer）**：执行人工验收与抽检。
- **设备维护（Ops）**：设备与网络保障、故障排查。
- **分析师/建模（Analyst/ML）**：消费数据、反馈质量需求。

## 12. 变更与版本管理

- **文档版本**：采用版本号与变更记录。
- **数据模式变更**：需评审与灰度发布，兼容旧版本。
- **处理管道变更**：测试通过后上线，保留回滚策略。

## 13. 里程碑与排期（示例）

- **第1周**：确认数据源与指标清单，完善元数据与命名规范。
- **第2–3周**：搭建采集与处理管道，制定质量与验收规则。
- **第4周**：试运行与抽检验收，形成首版验收报告与审计流程。
- **持续**：季度审计与优化。

## 14. 附录

### 附录A：数据字典模板（字段示例）
表名、字段名、类型、单位、取值范围、含义、是否可空、示例值、质量规则、备注。

### 附录B：验收检查清单（示例）
格式校验通过（是/否）、元数据齐全（是/否）、规则命中率≤阈值（是/否）、抽检一致度≥阈值（是/否）、异常处置闭环（是/否）、报告生成（是/否）。

### 附录C：图像标注规范摘要
- **汇总字段**：`count`、`avg_length_mm`、`avg_height_mm`、`est_weight_g_avg`、`feed_present`、`shrimp_shell_present`、`model_name`、`model_version`、`confidence_avg`。
- **文件格式**：COCO/自定义JSON；标签集版本与命名规范。

### 附录D：MySQL命名与索引规范（摘要）

- **命名**：小写+下划线；时间后缀统一为 `ts_utc`/`ts_local`；表与索引前缀遵循业务语义（如 `sr` 表示 `sensor_readings`）。
- **主键**：整型自增（`BIGINT UNSIGNED AUTO_INCREMENT`）或 UUID（按需）。
- **外键**：统一引用 `batches`（`batch_id`）与 `devices`（`device_id`），`image_detections` 引用 `image_frames`（`id`）。
- **时间类型**：统一使用 `DATETIME(3)` 以保留毫秒精度；UTC 与本地时间分列。
- **布尔类型**：统一使用 `TINYINT(1)`（0/1），避免 BOOLEAN 兼容差异。
- **引擎与字符集**：InnoDB + utf8mb4；校对建议使用 `utf8mb4_0900_ai_ci`（MySQL 8.0+）。
- **索引**：基于时间（`ts_utc`）与批次（`batch_id`）的联合索引；频繁查询维度如 `device_id`、`camera_id`、`metric` 建立联合索引。
- **传感器表设计**：采用窄表（metric+value）以便扩展与按指标维度检索。
- **分区建议**：长时间序数据可按月/季进行 RANGE 分区（`RANGE COLUMNS(ts_utc)`），结合联合索引评估。
- **一致性**：字段注释全面，兼容扩展字段（`notes`、`checksum`）。
- **约束**：使用 NOT NULL、DEFAULT、FOREIGN KEY、ENUM 限定取值范围（如质量标记/设备类型）。

### 附录E：DDL 导入与校验示例（Windows/PowerShell 与 Linux，幂等）

#### Windows/PowerShell（请根据安装路径与账号密码调整）

```powershell
# 1) 设置 mysql.exe 路径（示例）
$mysqlExe = "C:\Program Files\MySQL\MySQL Server 8.0\bin\mysql.exe"

# 2) 幂等导入 DDL（SOURCE 会重复执行，但 DDL 使用 IF NOT EXISTS，安全）
& $mysqlExe -u root -p -e "SOURCE f:/work/singa/schema/mysql_aquaculture_ddl.sql"

# 3) 校验数据库与表
& $mysqlExe -u root -p -e "USE aquaculture; SHOW TABLES;"
& $mysqlExe -u root -p -e "USE aquaculture; SELECT COUNT(*) AS tables_defined FROM information_schema.tables WHERE table_schema='aquaculture';"

# 4) 示例功能校验查询
& $mysqlExe -u root -p -e "USE aquaculture; SHOW CREATE TABLE sensor_readings;"
& $mysqlExe -u root -p -e "USE aquaculture; SELECT table_name, index_name, column_name FROM information_schema.statistics WHERE table_schema='aquaculture' ORDER BY table_name, index_name;"
```

#### Linux（或 WSL；请根据路径调整 SOURCE 文件位置）

```bash
# 1) 导入 DDL（幂等）
mysql -u root -p -e "SOURCE /mnt/f/work/singa/schema/mysql_aquaculture_ddl.sql"

# 2) 校验
mysql -u root -p -e "USE aquaculture; SHOW TABLES;"
mysql -u root -p -e "USE aquaculture; SELECT COUNT(*) FROM information_schema.tables WHERE table_schema='aquaculture';"

# 3) 示例查询
mysql -u root -p -e "USE aquaculture; SELECT * FROM information_schema.tables WHERE table_schema='aquaculture' LIMIT 5;"
```

## 15. 命令行操作（可选，用于人工执行时的幂等备份与替换示例）

**说明**：以下为Linux环境示例命令（非必须）。在执行前确认路径与权限。

### 幂等备份

```bash
mkdir -p backup
if [ -f "《日本陆上养殖数据处理计划》.md" ] && [ ! -f "backup/《日本陆上养殖数据处理计划》.backup.md" ]; then 
  cp "《日本陆上养殖数据处理计划》.md" "backup/《日本陆上养殖数据处理计划》.backup.md"
fi
```

### 安全替换（需确认）

```bash
echo "请确认将标准化内容覆盖原文件（Y/n）"
read -r ans
if [ "$ans" = "Y" ]; then 
  cp "标准化稿.md" "《日本陆上养殖数据处理计划》.md"
fi
```

---

**—— 完 ——**

